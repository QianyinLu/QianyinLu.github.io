<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Classify Insects using deep learning model</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="/deeplearning.html" rel="canonical" />
  <!-- Feed -->

  <link href="/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="Using a deep learning model to classify beetles, cockroaches and dragonflies">

    <meta name="author" content="Presnie Lu">

    <meta name="tags" content="Dashboard">
    <meta name="tags" content="Visualization">
    <meta name="tags" content="Streamlit">




<!-- Open Graph -->
<meta property="og:site_name" content="Presnie Lu"/>
<meta property="og:title" content="Classify Insects using deep learning model"/>
<meta property="og:description" content="Using a deep learning model to classify beetles, cockroaches and dragonflies"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/deeplearning.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-11-14 12:01:00-05:00"/>
<meta property="article:modified_time" content="2020-11-14 16:30:00-05:00"/>
<meta property="article:author" content="/author/presnie-lu.html">
<meta property="article:section" content="Deep Learning"/>
<meta property="article:tag" content="Dashboard"/>
<meta property="article:tag" content="Visualization"/>
<meta property="article:tag" content="Streamlit"/>
<meta property="og:image" content="/theme/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Classify Insects using deep learning model",
  "headline": "Classify Insects using deep learning model",
  "datePublished": "2020-11-14 12:01:00-05:00",
  "dateModified": "2020-11-14 16:30:00-05:00",
  "author": {
    "@type": "Person",
    "name": "Presnie Lu",
    "url": "/author/presnie-lu.html"
  },
  "image": "/theme/images/post-bg.jpg",
  "url": "/deeplearning.html",
  "description": "Using a deep learning model to classify beetles, cockroaches and dragonflies"
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>

              <li role="presentation"><a href="/pages/Intro.html">Introduction of the Author</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" >
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Classify Insects using deep learning model</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="/author/presnie-lu.html">Presnie Lu</a>
            | <time datetime="Sat 14 November 2020">Sat 14 November 2020</time>
        </span>
        <!-- TODO : Modified check -->
            <span class="post-meta"> | Updated on Sat 14 November 2020</span>
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p><strong>This article will use a deep learning model: Multilayer Perceptrons, to classify beetkes, cockroaches and dragonflies images.</strong></p>
<h1>Dataset</h1>
<p>This blog uses this <a href="https://www.dropbox.com/s/fn73sj2e6c9rhf6/insects.zip?dl=0">dataset</a> and these images were splitted into training and test set. The goal is to predict the label of test set with high accuracy.</p>
<h1>Multilayer Perceptron</h1>
<p>This blog will will use a multilayer perceptron model to make predictions. A multilayer perceptron (MLP) is a class of feedforward artificial neural network (ANN). Usually, an MLP have at least three layers of nodes: an input layer, a hidden layer and an output layer. Except for the input nodes, each node is a neuron that uses a nonlinear activation function like all other neural networks. MLP utilizes a supervised learning technique called backpropagation for training set. Therefore, the basic function of nonlinear separable patterns is carried out by adding a new layer called the hidden layer. Each input from the input layer is weighted and propagated through each node in hidden layer using an activation function to produce an output at the output layer.   </p>
<p>The training process in the MLP is consisted of forward and backward phases. In the forward phase, the error is calculated by minimizing any loss function. This error is used by the back propagation learning algorithm to adjust the weights. The output from each node is recalculated by using updated weights. Each time this process is repeated, the error is reduced.   </p>
<p>In general, MLPs are suitable for classification prediction problems where inputs are assigned a class or label. They are very flexible and can be used generally to learn a mapping from inputs to outputs. In terms of how do we use such model for image classification problem, I will the following diagram to explain the process.</p>
<p><img alt="MLP" src="/img/MLP.png" title="Illustration of MLP">    </p>
<p>The diagram is a fairly simple example of image classification using MLP from the research paper "Pattern Recognition of Thermal Images for Monitoring of Breathing Function". It shows the process of classifying images with 9 features and uses an MLP with 1 hideden layer. In real life, as we know, images can usually be represented with pixels, which in this graph, is just the "feature". Therefore, a general process can be summarized as the following:  </p>
<ol>
<li>Image attributes are extracted from the image(pixels)</li>
<li>Training image attributes are fed to the multilayer perceptron, adjusting weights through different back propagation. During this process, you can add as many hidden layers with any activation function as you want (notice that too complicated model usually has higher computational cost and has overfitting issue. )</li>
<li>Final output layer generates outcome label or probabilities of belongs to each category</li>
</ol>
<h1>Coding</h1>
<p>This part will implement the MLP on classifying the insects images.  </p>
<h2>Preprocessing the data</h2>
<p>The first step is to get the directory of all data:</p>
<div class="highlight"><pre><span></span><code><span class="c1">#directory</span>
<span class="n">dir_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dir_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;beetles&#39;</span><span class="p">,</span> <span class="s1">&#39;cockroach&#39;</span><span class="p">,</span> <span class="s1">&#39;dragonflies&#39;</span><span class="p">]:</span>
    <span class="n">train_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;insects/train/&#39;</span> <span class="o">+</span> <span class="n">i</span>
    <span class="n">test_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;insects/test/&#39;</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;./&#39;</span> <span class="o">+</span> <span class="n">train_dir</span><span class="p">):</span>
        <span class="n">dir_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_dir</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;./&#39;</span> <span class="o">+</span> <span class="n">test_dir</span><span class="p">):</span>
        <span class="n">dir_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_dir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span><span class="n">fname</span><span class="p">)</span>
</code></pre></div>

<p>Then, I used built two functions to generate our Xs and ys. Notice that I used Pillow library to convert an input jpeg to a 100x100 sized grey scale image array for processing. This step is used to make sure the size of images are consistent.   </p>
<div class="highlight"><pre><span></span><code><span class="c1">#figure size</span>
<span class="k">def</span> <span class="nf">generate_X</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#resize </span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>
        <span class="n">m_min_d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m_min_d</span><span class="p">,</span> <span class="n">m_min_d</span><span class="p">))</span>
        <span class="c1">#scale data</span>
        <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generate_Y</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*beetles.*&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*cockroach.*&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*dragonflies.*&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#training set</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">dir_train</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">dir_test</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">generate_X</span><span class="p">(</span><span class="n">dir_train</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_Y</span><span class="p">(</span><span class="n">dir_train</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">generate_X</span><span class="p">(</span><span class="n">dir_test</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_Y</span><span class="p">(</span><span class="n">dir_test</span><span class="p">)</span>
</code></pre></div>

<p>One additional step is required, which is scaling the images values between 0 and 1: </p>
<div class="highlight"><pre><span></span><code><span class="c1"># Scaling the images to values between 0 and 1</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span> <span class="o">/</span> <span class="mf">255.0</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span> <span class="o">/</span> <span class="mf">255.0</span>
</code></pre></div>

<h2>Model Building</h2>
<p>For this problem, I set up four layers in total. The first step is to flatten the image data into a single array. The other three layers are dense layers. In terms of activation function, I tried sigmoid and relu as well as softmax using grid hyperparameter tuning. The following showed their actual functions: <br>
<img alt="Sigmoid" src="/img/Sigmoid.png" title="Sigmoid Activation Function"> <br>
<img alt="ReLU" src="/img/ReLu.png" title="ReLU Activation Function"><br>
In addition, I also added the choice of the optimizer as stochastic gradient descent (SGD) or Adam for the compiler. The actual code looks like this:  </p>
<div class="highlight"><pre><span></span><code><span class="c1">#hyperparameter tuning </span>
<span class="k">def</span> <span class="nf">cv_parameter_tuning</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">activation1</span><span class="p">,</span><span class="n">activation2</span><span class="p">,</span> <span class="n">optimization</span><span class="p">):</span>
<span class="n">cv_acc</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">activation1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">activation2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">optimization</span><span class="p">:</span>
            <span class="n">fold_result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
                <span class="n">x_train1</span><span class="p">,</span><span class="n">y_train1</span> <span class="o">=</span>  <span class="n">X</span><span class="p">[</span><span class="n">train</span><span class="p">,:,:],</span> <span class="n">y</span><span class="p">[</span><span class="n">train</span><span class="p">]</span>
                <span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">val</span><span class="p">,:,:],</span> <span class="n">y</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                            <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
                            <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a1</span><span class="p">),</span>
                            <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a1</span><span class="p">),</span>
                            <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">a2</span><span class="p">)</span>
                            <span class="p">])</span>

                <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span>
                               <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
                               <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

                <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train1</span><span class="p">,</span> <span class="n">y_train1</span><span class="p">,</span><span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">loss</span><span class="p">,</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">fold_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>

            <span class="n">combo</span> <span class="o">=</span> <span class="s2">&quot;a1:&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;a2:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;opt:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
            <span class="c1">#take the average and std of all fold&#39;s accuracy, append it to the list</span>
            <span class="n">cv_acc</span><span class="p">[</span><span class="n">combo</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fold_result</span><span class="p">)</span>

<span class="k">return</span> <span class="n">cv_acc</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">cv_parameter_tuning</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">,[</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">],</span> <span class="p">[</span> <span class="s1">&#39;softmax&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;SGD&quot;</span><span class="p">,</span><span class="s2">&quot;Adam&quot;</span><span class="p">])</span>
</code></pre></div>

<p>From the grid search cross validation process, I chose the first two combinations with highest accuracy level, which are 1.'a1:sigmoid a2:softmax opt:Adam' and 2. 'a1:sigmoid a2:softmax opt:SGD'       </p>
<div class="highlight"><pre><span></span><code><span class="c1"># model building</span>

<span class="c1">#model 1</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
        <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">),</span>
        <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;Adam&quot;</span><span class="p">,</span>
          <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
          <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">model_hist</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">test_loss</span><span class="p">,</span> <span class="n">test_acc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy:&#39;</span><span class="p">,</span> <span class="n">test_acc</span><span class="p">)</span>

<span class="c1">#model 2</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
        <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">),</span>
        <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">model2</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;SGD&quot;</span><span class="p">,</span>
          <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
          <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">model_hist2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">test_loss2</span><span class="p">,</span> <span class="n">test_acc2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test accuracy:&#39;</span><span class="p">,</span> <span class="n">test_acc2</span><span class="p">)</span>
</code></pre></div>

<h2>Model Evaluation</h2>
<p>From the final outcome, model 1 ('a1:sigmoid a2:softmax opt:Adam') performs much better in test set with a loss of 0.59 and accuracy level of 0.9.<br>
<img alt="Result" src="/img/Acc_m.png" title="Final model accuracy">   </p>
<p>The following plot shows the prediction accuracy of training set as epoch size increases. As we can see that as the epoch number increases, the accuracy level of training data is getting higher (0.92) and it also getting more stable than before. From this we can see the dataset is also not overfitting as the training and test set has similar accuracy level.<br>
<img alt="Accuracy" src="/img/prediction_train.png" title="Training accuracy">   </p>
<p>Then, the next step is to see the actual predicition for our dataset. Because the model will render probabilities of each category for images, I just chose the category with the highest probability as the final category. </p>
<div class="highlight"><pre><span></span><code><span class="c1">#prediction</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">display_images</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">grid_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_size</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">class_names</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
<span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;beetles&#39;</span><span class="p">,</span> <span class="s1">&#39;cockroach&#39;</span><span class="p">,</span> <span class="s1">&#39;dragonflies&#39;</span><span class="p">]</span>
<span class="n">display_images</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div>

<p>The following showed the 25 images (order changed by shuffling; the image is grey scaled because of our preprocessing):  <br>
<img alt="Prediction" src="/img/insects_pred.png" title="Prediction"> <br>
With the actual classification (1. 'beetles'; 2. 'cockroach'; 3. 'dragonflies')<br>
<img alt="actual" src="/img/actual_c.png" title="Actual"><br>
We can see that most of the images got correctly classified except ones with very obscure representation of insects. (For intance, some only shows parts of the insects and human can even hardly identify which insects they belong to.) Therefore, we can say that our model is doing generally good. </p>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Classify Insects using deep learning model&amp;url=/deeplearning.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=/deeplearning.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=/deeplearning.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="/tag/dashboard.html">Dashboard</a><a href="/tag/visualization.html">Visualization</a><a href="/tag/streamlit.html">Streamlit</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="/theme/js/script.js"></script>

</body>
</html>